function init() {
  var $ = go.GraphObject.make;
  var myDiagram = $(go.Diagram, "myDiagramDiv", {
    "undoManager.isEnabled": true,
    initialAutoScale: go.Diagram.UniformToFill,
    initialViewportSpot: go.Spot.Center,
    initialDocumentSpot: go.Spot.Center,
    layout: $(go.TreeLayout, { angle: 90, layerSpacing: 40 })
  });

  function getColor(level) {
    switch (level) {
      case 0: return "#f4e58f"; // root gialla
      case 1: return "#a9d8ec"; // blu sezioni
      case 2: return "#a7f3a7"; // verde concetti
      case 3: return "#ffc8d0"; // rosso esempi/dettagli
      default: return "#e8e7e7";
    }
  }

  myDiagram.nodeTemplate =
    $(go.Node, "Auto",
      $(go.Shape, "RoundedRectangle",
        { stroke: null },
        new go.Binding("fill", "level", getColor)),
      $(go.TextBlock,
        {
          margin: 8,
          font: "8pt Montserrat, sans-serif",
          textAlign: "center",
          wrap: go.TextBlock.WrapFit,
          maxSize: new go.Size(170, NaN)
        },
        new go.Binding("text", "key"))
    );

  myDiagram.linkTemplate =
    $(go.Link,
      { routing: go.Link.Orthogonal, curve: go.Link.None, corner: 0 },
      $(go.Shape, { strokeWidth: 1, stroke: "#555" }),
      $(go.Shape, { toArrow: "Standard", stroke: null, fill: "#555" })
    );

  myDiagram.model = new go.GraphLinksModel(
    [
      { key: "Ciclo di vita di un malware", level: 0 },

      { key: "Fase di infezione", level: 1 },
      { key: "Supera barriere di sicurezza", level: 2 },
      { key: "Si installa nel dispositivo", level: 2 },
      { key: "Modifica impostazioni per persistenza", level: 2 },
      { key: "Si nasconde dai software di sicurezza", level: 2 },

      { key: "Fase di quiescenza", level: 1 },
      { key: "Stato dormiente in attesa di condizioni", level: 2 },
      { key: "Condizioni: tempo, operazioni, comandi remoti", level: 2 },
      { key: "Resta residente in memoria", level: 2 },

      { key: "Fase di replicazione e propagazione", level: 1 },
      { key: "Replica su altri sistemi", level: 2 },
      { key: "Reti locali, dispositivi removibili", level: 3 },
      { key: "E-mail e siti compromessi", level: 3 },

      { key: "Fase di azioni malevole", level: 1 },
      { key: "Furto di dati sensibili", level: 2 },
      { key: "Distruzione o alterazione file", level: 2 },
      { key: "Blocco tramite ransomware", level: 2 },
      { key: "Apertura di backdoor", level: 2 },
      { key: "Può tornare in quiescenza", level: 2 },

      { key: "Conclusione", level: 0 },
      { key: "Alternanza di occultamento e attacco", level: 1 },
      { key: "Analisi delle fasi = strategie difensive", level: 1 }
    ],
    [
      { from: "Ciclo di vita di un malware", to: "Fase di infezione" },
      { from: "Fase di infezione", to: "Supera barriere di sicurezza" },
      { from: "Fase di infezione", to: "Si installa nel dispositivo" },
      { from: "Fase di infezione", to: "Modifica impostazioni per persistenza" },
      { from: "Fase di infezione", to: "Si nasconde dai software di sicurezza" },

      { from: "Ciclo di vita di un malware", to: "Fase di quiescenza" },
      { from: "Fase di quiescenza", to: "Stato dormiente in attesa di condizioni" },
      { from: "Fase di quiescenza", to: "Condizioni: tempo, operazioni, comandi remoti" },
      { from: "Fase di quiescenza", to: "Resta residente in memoria" },

      { from: "Ciclo di vita di un malware", to: "Fase di replicazione e propagazione" },
      { from: "Fase di replicazione e propagazione", to: "Replica su altri sistemi" },
      { from: "Replica su altri sistemi", to: "Reti locali, dispositivi removibili" },
      { from: "Replica su altri sistemi", to: "E-mail e siti compromessi" },

      { from: "Ciclo di vita di un malware", to: "Fase di azioni malevole" },
      { from: "Fase di azioni malevole", to: "Furto di dati sensibili" },
      { from: "Fase di azioni malevole", to: "Distruzione o alterazione file" },
      { from: "Fase di azioni malevole", to: "Blocco tramite ransomware" },
      { from: "Fase di azioni malevole", to: "Apertura di backdoor" },
      { from: "Fase di azioni malevole", to: "Può tornare in quiescenza" },

      { from: "Ciclo di vita di un malware", to: "Conclusione" },
      { from: "Conclusione", to: "Alternanza di occultamento e attacco" },
      { from: "Conclusione", to: "Analisi delle fasi = strategie difensive" }
    ]);
}

window.addEventListener("DOMContentLoaded", init);
